{% extends "base.html" %}

{% block title %}Linear Regression Analysis{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-chart-line"></i> Linear Regression Analysis</h1>
    <p>Find the best-fit line through data points using error minimization</p>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-dot-circle"></i></div>
        <h3>Data Points</h3>
        <p class="stat-value">{{ data.summary.total_points }}</p>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-sliders-h"></i></div>
        <h3>Best Slope (m)</h3>
        <p class="stat-value">{{ data.best_line.best_m }}</p>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-arrows-alt-v"></i></div>
        <h3>Best Intercept (b)</h3>
        <p class="stat-value">{{ data.best_line.best_b }}</p>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
        <h3>Total Error</h3>
        <p class="stat-value">{{ data.best_line.smallest_error }}</p>
    </div>
    <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-percentage"></i></div>
        <h3>RÂ² Score</h3>
        <p class="stat-value">{{ data.r_squared }}</p>
    </div>
</div>

<div class="section">
    <h2><i class="fas fa-chart-scatter"></i> Linear Regression Visualization</h2>
    <div class="chart-container">
        <canvas id="regressionChart"></canvas>
    </div>
    <div class="chart-description">
        <h4><i class="fas fa-info-circle"></i> What This Chart Shows</h4>
        <p>This scatter plot displays the data points along with the best-fit regression line. The line equation <strong>y = mx + b</strong> is found by minimizing the total error between the line and all data points.</p>
        
        <div class="insight-box">
            <strong>Key Insight:</strong> The best-fit line has the equation <strong>{{ data.best_line.equation }}</strong> with a total error of <strong>{{ data.best_line.smallest_error }}</strong>. The RÂ² score of <strong>{{ data.r_squared }}</strong> indicates how well the line fits the data (closer to 1.0 is better).
        </div>
        
        <div class="key-takeaway">
            ðŸ’¡ <strong>Takeaway:</strong> Linear regression helps predict y-values for new x-values. The lower the error, the better the model fits the data. This technique is fundamental in machine learning and data science.
        </div>
        
        <ul>
            <li><strong>How it works:</strong> The algorithm tests many possible slopes (m) and intercepts (b) to find the combination that minimizes total error</li>
            <li><strong>Error calculation:</strong> Error is the vertical distance between each point and the line</li>
            <li><strong>RÂ² interpretation:</strong> RÂ² = 1.0 means perfect fit, RÂ² = 0 means the line is no better than the mean</li>
            <li><strong>Prediction:</strong> Use the equation to predict y for any x value: y = {{ data.best_line.best_m }}x + {{ data.best_line.best_b }}</li>
        </ul>
    </div>
</div>

<div class="section">
    <h2><i class="fas fa-table"></i> Data Points</h2>
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>X Value</th>
                    <th>Y Value (Actual)</th>
                    <th>Y Value (Predicted)</th>
                    <th>Error</th>
                </tr>
            </thead>
            <tbody>
                {% for point in data.datapoints %}
                <tr>
                    <td>{{ point[0] }}</td>
                    <td>{{ point[1] }}</td>
                    <td>{{ "%.2f"|format(data.predictions[loop.index0]) }}</td>
                    <td>{{ "%.2f"|format((data.predictions[loop.index0] - point[1])|abs) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    const datapoints = {{ data.datapoints|tojson }};
    const lineData = {{ data.line_data|tojson }};
    const predictions = {{ data.predictions|tojson }};
    
    const ctx = document.getElementById('regressionChart').getContext('2d');
    const regressionChart = new Chart(ctx, {
        type: 'scatter',
        data: {
            datasets: [
                {
                    label: 'Data Points',
                    data: datapoints.map(p => ({x: p[0], y: p[1]})),
                    backgroundColor: 'rgba(102, 126, 234, 0.7)',
                    borderColor: '#667eea',
                    pointRadius: 8,
                    pointHoverRadius: 10,
                    showLine: false
                },
                {
                    label: 'Best Fit Line',
                    data: lineData.x.map((x, i) => ({x: x, y: lineData.y[i]})),
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    borderColor: '#e74c3c',
                    borderWidth: 3,
                    pointRadius: 0,
                    fill: false,
                    showLine: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Linear Regression: Data Points and Best Fit Line'
                },
                legend: {
                    display: true,
                    position: 'top'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            if (context.datasetIndex === 0) {
                                return `Point: (${context.parsed.x}, ${context.parsed.y})`;
                            } else {
                                return `Line: y = {{ data.best_line.best_m }}x + {{ data.best_line.best_b }}`;
                            }
                        }
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'X Values'
                    },
                    beginAtZero: false
                },
                y: {
                    title: {
                        display: true,
                        text: 'Y Values'
                    },
                    beginAtZero: false
                }
            }
        }
    });
</script>
{% endblock %}

